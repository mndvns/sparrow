head
  title Sparrow
  meta(name='viewport',content='initial-scale=1.0, user-scalable=no')
  meta(charset='utf-8')

body
  {{> body }}

mixin topnav(name)
  .topnav.navbar: .navbar-inner: .container
    if (name === "home")
      .shift(data-shift-direction="left", data-shift-area="about").home.left
        i.glyph-arrow-left
        // i.icon-large.logo.glyph-cassette
      .shift(data-shift-direction="right", data-shift-area="account").home.right
        span {{loginButtons}}
        {{#if signedIn}}
        i.glyph-arrow-right {{/if}}
    if (name === "about")
      .shift(data-shift-direction="right", data-shift-area="home"): i.glyph-arrow-right
    if (name === "account")
      .shift(data-shift-direction="left", data-shift-area="home"): i.glyph-arrow-left
      ul.links
        li(data-page="offer")
          i.glyph-clipboard
          span offer
        li(data-page="metrics")
          i.glyph-presentation
          span metrics
        li(data-page="profile")
          i.glyph-paper-plane
          span profile

        // a(href="/account/offer"): i.glyph-cassette
        // a(href="/account/metrics"): i.glyph-presentation
        // a(href="/account/profile"): i.icon-cogs

template(name="body")
  .content
    .current
      {{#constant}}{{/constant}}

      {{#if sessionEquals 'shift_current' 'home'}}
      mixin topnav("home") {{/if}}
      {{#if sessionEquals 'shift_current' 'account'}}
      mixin topnav("account") {{/if}}
      {{#if sessionEquals 'shift_current' 'about'}}
      mixin topnav("about") {{/if}}

      .container
        {{renderPage}}

    .next
      {{#constant}}{{/constant}}

      {{#if sessionEquals 'shift_area' 'home'}}
      mixin topnav("home") {{/if}}
      {{#if sessionEquals 'shift_area' 'account'}}
      mixin topnav("account") {{/if}}
      {{#if sessionEquals 'shift_area' 'about'}}
      mixin topnav("about") {{/if}}

      .container
        {{#if page_next "about"}} {{> about }} {{/if}}
        {{#if page_next "home"}} {{> home }} {{/if}}
        {{#if page_next "account"}} {{> account }} {{/if}}


template(name="about")
  .greeting
    h1 Sparrow
    h2 Loremy ipsum set loret
    p.
      Lorem ipsum dolor sit amet, consectetur adipiscing elit.
      Suspendisse congue convallis eleifend.
      Sed at nisl ut eros interdum lacinia rutrum ac neque. Aliquam 
      convallis aliquet laoreet. Quisque lacus lacus, blandit eu iaculis
    p.
      Sit amet, aliquet sit amet purus. Vivamus nec nulla eu elit convallis consequat.
      Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.
      Nam a consectetur odio. Lorem ipsum dolor sit amet, consectetur adipiscing elit.
      Vivamus vitae eros eget justo dapibus mattis at sit amet enim. Cras enim nisi,
      consectetur sit amet convallis ut, ultricies ut eros. Maecenas at diam et
      nisl faucibus rhoncus et in neque.
    p.
      Suspendisse congue convallis eleifend.
      Sed at nisl ut eros interdum lacinia rutrum ac neque. Aliquam 
      convallis aliquet laoreet. Quisque lacus lacus, blandit eu iaculis

template(name='home')
  {{> hero}}
  {{#each getOffers}}
  {{> offer}}
  {{/each}}

template(name="hero")
  .hero
    {{#constant}}

    .headline
      .inner
        .tagset
        .sort
        .tag
        .noun

    .list.long
      ul.tagset-list.span3(data-constant=true)
      ul.sort-list.span3(data-constant=true).margin.left
      ul.tag-list.span3.margin.left
      ul.noun-list.span3(data-constant=true).margin.left

    {{/constant}}

template(name="404")
  h1.
    Are you lost?

template(name='editor')
  div.editor(id="{{name}}").row
    h1.capitalize {{name}}

    table.table.table-hover.span4.offset1
      thead: tr
        {{#each keys}}
        th(id="{{this}}") {{this}}
        {{/each}}
      tbody
        {{#each collection}}
        tr(id="{{this._id}}")
          {{#key_value this}}
          td(id="{{key}}") {{value}}
          {{/key_value}}
        {{/each}}

    form(action='').span4.offset1
      {{#each keys}}
      .control-group(id="{{this}}")
        label.control-label.capitalize {{this}}
        .controls
          input.text(type="text", id="{{this}}")
      {{/each}}
      .btn-group
        button.btn.save(type='button')#update Update
        button.btn.save(type='button')#add Add
        button.btn.btn-warning.remove(type='button')#remove Remove


template(name='admin_users')
  {{#grab "Users"}}
  {{> editor }}
  {{/grab}}

template(name='admin_tags')
  {{#grab "Tagsets"}}
  {{> editor }}
  {{/grab}}

  {{#grab "Tags"}}
  {{> editor }}
  {{/grab}}

template(name="admin_sorts")
  {{#grab "Sorts"}}
  {{> editor }}
  {{/grab}}

template(name="admin_offers")
  {{#grab "Offers"}}
  {{> editor }}
  {{/grab}}

template(name="admin_metrics")
  h1 DERP

template(name='account')

  {{#if sessionEquals 'accountPage' 'profile'}}
  {{> account_profile }}
  {{/if}}

  {{#if sessionEquals 'accountPage' 'offer'}}
  {{> account_offer }}
  {{/if}}

  {{#if sessionEquals 'accountPage' 'metrics'}}
  {{> account_metrics }}
  {{/if}}


template(name='account_profile')
  {{#grab "User"}}
  {{this.collection.username}}
  {{> editor }}
  {{/grab}}

  // {{#grab "User"}}
  // {{#first this.collection}}
  // .greeting 
  //   h1 Hi, {{this.username}}!
  // {{/first}}
  // {{/grab}}

template(name='account_metrics')
  {{#with getUser}}
  ul
    li
      strong Offers: 
      {{offers}}
    li
      strong Votes: 
      {{votes.length}}{{/with}}

template(name='account_offer')

  {{#with getOffer}}
  .account.navbar: .navbar-inner: .container
    ul.nav
      mixin nav-item(a, b, c)
        li(class= c, data-value= a)
          i(class="glyph-" + b)
          | #{a}
      mixin nav-item("text", "feather", "show")
      mixin nav-item("tags", "tag-2", "show")
      mixin nav-item("symbol", "palette", "show")
      mixin nav-item("location", "map", "show")
      mixin nav-item("qr", "qrcode", "show")
      mixin nav-item("save", "disk", "save")
      mixin nav-item("help", "help", "help")

  .clearfix

  {{#if sessionEquals 'help' 'true'}}
  .help-unit.row
    {{#if sessionEquals 'show' 'intro'}}
    .span6.offset3.intro
      h3 Welcome to your offer area!
      p.
        Here you can create, edit, and publish your offer in a matter of seconds. The "help" selection
        is on by default, so you'll see more of this text. Whenever you want, you can turn off the
        help text by hitting the toggle in the upper left.
      br
      p: strong Ready to make an offer?
      button.btn.btn-large.show(data-value="text", color="{{this.color}}"): em Let's go!
    {{/if}}
    {{#if sessionEquals 'show' 'text'}}
    .span12
      h3 What are we selling?
    .span5.offset1
      p.
        Although everyone buys differently, we all want
        to know what the product is, who is selling it, and for how much.
      p.
        You might notice that we limit the amount you can write. Sorry 'bout that. If you're having
        trouble condensing your product's information, try this little exercise out...
      p.
        Pretend you're dangling from a cliff and you needed this object to save your life. Your friend
        wants to help you, but he is up some distance at the top of the cliff, unable to reach you.
    .span5
      p.
        At this moment, he is waiting for you yell up and describe the object to him so he can
        retrive it from your car and lower it to you with a rope.
      p.
        What do you yell to him?
      p.
        Did that help? Maybe? It's a weird exercise. Me, personally, I would just yell for the rope,
        but I think that's against the rules.
    {{/if}}
  {{/if}}


  {{#if status_alert}} {{#with status_alert}}
  div(class="{{this.type}}").alert.alert-block
    button.close(type='button', data-dismiss='alert') Ã—
    h4.alert-heading {{this.heading}}
    p {{this.message}}
  {{/with}} {{/if}}

  .account_offer
    {{#if sessionEquals 'show' 'intro'}} {{else}}
    {{> offer}} {{/if}}

  .clearfix.pad

    mixin field(a, z, b, m, c, r)
      .control-group
        label.control-label #{a}
        if b == "text"
          .controls: input(class= b +" "+ m, id= a, type= b, tabindex= c, value= z)
        if b == "textarea"
          .controls: textarea(class= b +" "+ m, id= a, type= b, tabindex= c, value= z, rows= r) #{z}

    {{#if show "text"}}
    .area
      form
        .span5.offset1
          mixin field("name", "{{this.name}}", "text", "span4", 1)
          mixin field("description", "{{this.description}}", "textarea", "span4", 2, 3)
        .span5
          mixin field("business", "{{this.business}}", "text", "span4", 3)
          mixin field("price", "{{this.price}}", "text", "span2", 4)
      .clearfix
    {{/if}}


    {{#if show "qr"}}
    .area
      .actions
        div.icon
          i.glyph-qrcode#qr-button
          br
          span qr code
      #qr-code
      .clearfix
    {{/if}}

    {{#if show "symbol"}}
    .area
      .glyphs-list.row
        .span11.inner
          input.text.color(type='text', style='background: {{this.color}}', value="{{this.color}}")
          .clearfix
          {{#each getIcons}}
          .glyph
            .large(class="glyph-{{this}}")
          {{/each}}
        {{/if}}

      {{#if show "tags"}}
      h1
      .tag-list
        {{#each find 'Tagsets' '{}'}}
        {{#with checkTagsetActive}}
        ul.span2.tagset(data-tagset="{{this.name}}", data-status="{{this.attr}}")
          strong {{this.name}}
          {{#each getTags}}
          li
            {{#with checkTagActive}}
            | <span {{attr}}>{{name}}</span>
            {{/with}}
          {{/each}}
        {{/with}}
        {{/each}}
    {{/if}}

    {{#if show "location"}}
    .area
      form#location
        .span5.offset3
          mixin field("street", "{{this.street}}", "text", "span5", 1)
          mixin field("city", "{{this.city}}", "text", "span4", 2 )
          mixin field("state", "{{this.state}}", "text", "span2", 2 )
          mixin field("zip", "{{this.zip}}", "text", "span2", 2 )
      {{/if}}
    {{/with}}


template(name='thisOffer')
  div.thisOffer
    {{#with getThisOffer}}
    {{> offer}}
    .input-append
      input.text(type="text")
      button.btn Go!
    {{/with}}

template(name='offer')
  div.offer(data-tagset="{{this.tagset}}").long
    section.symbol(style="background: {{this.color}}").span2
      div(class='{{this.symbol}}')
    section.main(style="background: {{this.color}}").span4
      span.field(data-field='name') {{this.name}}
      p.field(data-field='description') {{this.description}}
      span.field(data-field='business') {{this.business}}
      br
    section.actions
      .votes(style="background: {{this.color}}").span2.margin.left
        i.glyph-plus.full-icon(data-status="inactive", data-selector="vote")
        .metric(style="background: {{this.color}}")
          span {{this.votes}} votes
        .bg
      .map.distance(style="background: {{this.color}}").span2.margin.left
        i.glyph-location.full-icon(data-status="inactive", data-selector="map")
        .metric(style="background: {{this.color}}")
          span {{this.distance}} mi.
        .bg
      .buy.price(style="background: {{this.color}}").span2.margin.left
        i.glyph-tag-2.full-icon(data-status="inactive", data-selector="buy")
        .metric(style="background: {{this.color}}")
          span ${{this.price}}
        .bg
    section.extension(data-extension="map")
    section.extension(data-extension="message")
      {{> message}}
    section.extension(data-extension="buy")

template(name="message")
  form.form-horizontal
    .control-group
      label.control-label LABEL
      .controls
        textarea(rows=3)



template(name="redirect")
  button.btn All done!
